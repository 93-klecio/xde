{"version":3,"sources":["application/PackagerController.js"],"names":[],"mappings":"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","file":"application/PackagerController.js","sourcesContent":["let child_process = require('child_process');\nlet crayon = require('@ccheever/crayon');\nlet express = require('express');\nlet freeportAsync = require('freeport-async');\nlet instapromise = require('instapromise');\nlet ngrok = require('ngrok');\nlet path = require('path');\nlet proxy = require('express-http-proxy');\nlet events = require('events');\n\nlet Exp = require('./Exp');\nlet urlUtils = require('./urlUtils');\n\nclass PackagerController extends events.EventEmitter {\n  constructor(opts) {\n    super(opts);\n\n    let DEFAULT_OPTS = {\n      port: undefined,\n      cliPath: path.join(__dirname, '..', '..', 'node_modules/react-native/local-cli/cli.js'),\n      mainModulePath: 'index.js',\n      // absolutePath: root,\n    };\n\n    this.opts = Object.assign(DEFAULT_OPTS, opts);\n    this._givenOpts = opts;\n\n    global._PackagerController = this;\n  }\n\n  async startOrRestartLocalServerAsync() {\n    if (this._expressServer) {\n      console.log(\"Waiting for express to close...\");\n      await this._expressServer.close();\n      console.log(\"Closed express; restarting...\");\n    }\n\n    let app = express();\n    let self = this;\n\n    // Proxy '/bundle' to the packager.\n    app.use('/bundle', proxy('localhost:' + this.opts.packagerPort, {\n      forwardPath: (req, res) => {\n        let queryString = require('url').parse(req.url).query;\n        let platform = req.headers['exponent-platform'] || 'ios';\n        let path = '/' + urlUtils.guessMainModulePath(self.opts.entryPoint);\n        path += '.bundle';\n        path += '?' + queryString + '&platform=' + platform;\n        return path;\n      },\n    }));\n\n    // Proxy sourcemaps to the packager.\n    app.use('/', proxy('localhost:' + this.opts.packagerPort, {\n      filter: function(req, res) {\n        let path = require('url').parse(req.url).path;\n        return path.indexOf('.map') > -1;\n      },\n    }));\n\n    // Serve the manifest.\n    let manifestHandler = async function(req, res) {\n      let pkg = await Exp.packageJsonForRoot(self.opts.absolutePath).readAsync();\n      let manifest = pkg.exp || {};\n      let queryString = require('url').parse(req.url).query;\n      manifest.bundlePath = 'bundle?' + queryString\n      res.setHeader('Content-Type', 'application/json');\n      res.send(JSON.stringify(manifest));\n    };\n\n    app.get('/', manifestHandler);\n    app.get('/manifest', manifestHandler);\n\n    this._expressServer = app.listen(this.opts.port, () => {\n      let host = this._expressServer.address().address;\n      let port = this._expressServer.address().port;\n\n      console.log('Local server listening at http://%s:%s', host, port);\n    });\n  }\n\n  async startOrRestartNgrokAsync() {\n    if (this._ngrokUrl) {\n      console.log(\"Waiting for ngrok to disconnect...\");\n      await this._stopNgrokAsync();\n      console.log(\"Disconnected ngrok; restarting...\");\n    }\n\n    this.emit('ngrok-will-start', this.opts.port);\n\n    this._ngrokUrl = await ngrok.promise.connect(this.opts.port);\n\n    this.emit('ngrok-did-start', this.opts.port, this._ngrokUrl);\n    this.emit('ngrok-ready', this.opts.port, this._ngrokUrl);\n\n    console.log(\"Connected ngrok to port \" + this.opts.port + \" via \" + this._ngrokUrl);\n    return this._ngrokUrl;\n  }\n\n  async startOrRestartPackagerAsync() {\n\n    if (!this.opts.packagerPort) {\n      throw new Error(\"`this.opts.packagerPort` must be set before starting the packager!\");\n    }\n\n    let root = this.opts.absolutePath;\n    if (!root) {\n      throw new Error(\"`this.opts.absolutePath` must be set to start the packager!\");\n    }\n\n    await this._stopPackagerAsync();\n\n    // Note: the CLI script sets up graceful-fs and sets ulimit to 4096 in the\n    // child process\n    let nodePath = path.resolve(__dirname, '../../node/v4.1.1/bin/node');\n    let packagerProcess = child_process.spawn(nodePath, [\n      this.opts.cliPath,\n      'start',\n      '--port', this.opts.packagerPort,\n      '--projectRoots', root,\n      '--assetRoots', root,\n    ], {\n        // stdio: [process.stdin, process.stdout, process.stderr],\n        // stdio: 'inherit',\n        // detached: false,\n        cwd: path.dirname(path.dirname(this.opts.cliPath)),\n        env: {\n          ...process.env,\n          NODE_PATH: null,\n        },\n      });\n    process.on('exit', () => {\n      packagerProcess.kill();\n    });\n    this._packager = packagerProcess;\n    this._packager.stdout.setEncoding('utf8');\n    this._packager.stderr.setEncoding('utf8');\n    this._packager.stdout.on('data', (data) => {\n      this.emit('stdout', data);\n\n      if (data.match(/React packager ready\\./)) {\n        // this._packagerReadyFulfill(this._packager);\n        // this._packagerReady = true;\n        this.emit('packager-ready', this._packager);\n      }\n\n      // crayon.yellow.log(\"STDOUT:\", data);\n    });\n\n    this._packager.stderr.on('data', (data) => {\n      this.emit('stderr', data);\n      // crayon.orange.error(\"STDERR:\", data);\n    });\n\n    this.packagerExited$ = new Promise((fulfill, reject) => {\n      this._packagerExitedFulfill = fulfill;\n      this._packagerExitedReject = reject;\n    });\n\n    this._packager.on('exit', (code) => {\n      console.log(\"packager process exited with code\", code);\n      // console.log(\"packagerExited$ should fulfill\");\n      this._packagerExitedFulfill(code);\n      this.emit('packager-stopped', code);\n    });\n\n  }\n\n  async _stopPackagerAsync() {\n\n    if (this._packager && (!this._packager.killed && (this._packager.exitCode === null))) {\n      console.log(\"Stopping packager...\");\n      let stopped$ = new Promise((fulfill, reject) => {\n        let timeout = setTimeout(() => {\n          console.error(\"Stopping packager timed out!\");\n          reject();\n        }, 10000);\n        this._packager.on('exit', (exitCode) => {\n          clearTimeout(timeout);\n          fulfill(exitCode);\n        });\n      });\n      this.emit('packager-will-stop');\n      this._packager.kill('SIGTERM');\n      return stopped$;\n    } else {\n      console.log(\"Packager already stopped.\");\n    }\n  }\n\n  async _stopNgrokAsync() {\n\n    if (this._ngrokUrl) {\n      this.emit('ngrok-will-disconnect', this._ngrokUrl);\n      try {\n        await ngrok.promise.disconnect(this._ngrokUrl);\n        let oldNgrokUrl = this._ngrokUrl;\n        this._ngrokUrl = null;\n        // this._ngrokDisconnectedFulfill(oldNgrokUrl);\n        // console.log(\"Disconnected ngrok\");\n        this.emit('ngrok-disconnected', oldNgrokUrl);\n      } catch (e) {\n        console.error(\"Problem disconnecting ngrok:\", e);\n        // this._ngrokDisconnectedReject(e);\n        this.emit('ngrok-disconnect-err', e);\n      }\n    }\n\n  }\n\n  async startAsync() {\n\n    // let root = this.opts.absolutePath;\n    if (!this.opts.port || !this.opts.packagerPort) {\n      let ports = await freeportAsync.rangeAsync(2, 19000);\n      this.opts.port = ports[0];\n      this.opts.packagerPort = ports[1];\n    }\n\n    await Promise.all([\n      this.startOrRestartLocalServerAsync(),\n      this.startOrRestartPackagerAsync(),\n      this.startOrRestartNgrokAsync(),\n    ]);\n\n    return this;\n  }\n\n  async getNgrokUrlAsync() {\n    return this._ngrokUrl;\n  }\n\n  getNgrokUrl() {\n    return this._ngrokUrl;\n  }\n\n  getProjectShortName() {\n    return path.parse(this.opts.absolutePath).base;\n  }\n\n}\n\nmodule.exports = PackagerController;\n\nmodule.exports.testIntance = function (opts) {\n  let pc = new PackagerController(Object.assign({}, {\n    absolutePath: '/Users/ccheever/tmp/icecubetray',\n  }, opts));\n  pc.on('stdout', crayon.green.log);\n  pc.on('stderr', crayon.red.log);\n  pc.on('packager-stopped', () => {\n    crayon.orange('packager-stopped');\n  });\n  pc.startAsync();\n  return pc;\n}\n"],"sourceRoot":"/source/"}