{"version":3,"sources":["application/Exp.js"],"names":[],"mappings":"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","file":"application/Exp.js","sourcesContent":["let jsonFile = require('@exponent/json-file');\nlet existsAsync = require('exists-async');\nlet fs = require('fs');\nlet fsExtra = require('fs-extra');\nlet mkdirp = require('mkdirp');\nlet path = require('path');\n\nlet userSettings = require('./userSettings');\n\nlet TEMPLATE_ROOT = path.resolve(path.join(__dirname, '../../template'));\n\nfunction NewExpError(code, message) {\n  let err = new Error(message);\n  err.code = code;\n  err._isNewExpError;\n  return err;\n}\n\nfunction packageJsonForRoot(root) {\n  return jsonFile(path.join(root, 'package.json'));\n}\n\nasync function determineEntryPoint(root) {\n  let pkgJson = packageJsonForRoot(root);\n  let main = await pkgJson.getAsync('main', 'index.js');\n  // console.log(\"main=\", main);\n  return main;\n}\n\nasync function _getReactNativeVersionAsync() {\n  let xdePackageJson =  jsonFile(path.join(__dirname, '../../package.json'));\n  return await xdePackageJson.getAsync(['dependencies', 'react-native']);\n}\n\nasync function _installReactNativeInNewProjectWithRoot(root) {\n  let nodeModulesPath = path.join(root, 'node_modules');\n  await mkdirp.promise(nodeModulesPath);\n  await fsExtra.copy.promise(path.join(__dirname, '../../node_modules/react-native'), path.join(nodeModulesPath, 'react-native'));\n}\n\nasync function createNewExpAsync(root, info, opts) {\n\n  let pp = path.parse(root);\n  let name = pp.name;\n\n  // opts = opts || {force: true};\n  opts = opts || {};\n\n  let author = await userSettings.getAsync('email', undefined);\n\n  let dependencies = {\n    'react-native': await _getReactNativeVersionAsync(),\n  };\n\n  let data = Object.assign({\n    name,\n    version: '0.0.0',\n    description: \"Hello Exponent!\",\n    main: 'main.js',\n    author,\n    dependencies,\n    //license: \"MIT\",\n    // scripts: {\n    //   \"test\": \"echo \\\"Error: no test specified\\\" && exit 1\"\n    // },\n  }, info);\n\n  let pkgJson = jsonFile(path.join(root, 'package.json'));\n\n  let exists = await existsAsync(pkgJson.file);\n  if (exists && !opts.force) {\n    throw NewExpError('WONT_OVERWRITE_WITHOUT_FORCE', \"Refusing to create new Exp because package.json already exists at root\");\n  }\n\n  await mkdirp.promise(root);\n\n  let result = await pkgJson.writeAsync(data);\n\n  await fsExtra.promise.copy(TEMPLATE_ROOT, root);\n\n  // Custom code for replacing __NAME__ in main.js\n  let mainJs = await fs.readFile.promise(path.join(TEMPLATE_ROOT, 'main.js'), 'utf8');\n  let customMainJs = mainJs.replace(/__NAME__/g, data.name);\n  result = await fs.writeFile.promise(path.join(root, 'main.js'), customMainJs, 'utf8');\n\n  // Intall react-native\n  await _installReactNativeInNewProjectWithRoot(root);\n\n  return data;\n\n}\n\nasync function saveRecentExpRootAsync(root) {\n  // Write the recent Exps JSON file\n  let recentExpsJsonFile = userSettings.recentExpsJsonFile();\n  let recentExps = await recentExpsJsonFile.readAsync({cantReadFileDefault: []});\n  // Filter out copies of this so we don't get dupes in this list\n  recentExps = recentExps.filter(function (x) {\n    return x != root;\n  });\n  recentExps.unshift(root);\n  return await recentExpsJsonFile.writeAsync(recentExps.slice(0, 100));\n}\n\nfunction getHomeDir() {\n  return process.env[(process.platform == 'win32') ? 'USERPROFILE' : 'HOME'];\n}\n\nfunction makePathReadable(pth) {\n  let homedir = getHomeDir();\n  if (pth.substr(0, homedir.length) === homedir) {\n    return '~' + pth.substr(homedir.length);\n  } else {\n    return pth;\n  }\n}\n\nasync function expInfoAsync(root) {\n  let pkgJson = packageJsonForRoot(root);\n  let pkg = await pkgJson.readAsync();\n  let name = pkg.name;\n  let description = pkg.description;\n  return {\n    readableRoot: makePathReadable(root),\n    root,\n    name,\n    description,\n  };\n}\n\nasync function expInfoSafeAsync(root) {\n  try {\n    return expInfoAsync(root);\n  } catch (e) {\n    return null;\n  }\n}\n\nasync function recentValidExpsAsync() {\n  let recentExpsJsonFile = userSettings.recentExpsJsonFile();\n  let recentExps = await recentExpsJsonFile.readAsync({cantReadFileDefault: []});\n\n  let results = await Promise.all(recentExps.map(expInfoSafeAsync));\n\n  console.log(\"results=\", results);\n\n  let filteredResults = results.filter((x) => {\n    return !!x;\n  });\n\n  return filteredResults.slice(0, 5);\n\n}\n\nmodule.exports = {\n  determineEntryPoint,\n  createNewExpAsync,\n  saveRecentExpRootAsync,\n  recentValidExpsAsync,\n  _getReactNativeVersionAsync,\n};\n"],"sourceRoot":"/source/"}