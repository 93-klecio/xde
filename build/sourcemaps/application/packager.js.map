{"version":3,"sources":["application/packager.js"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;AAAA,IAAI,aAAa,GAAG,OAAO,CAAC,eAAe,CAAC,CAAC;AAC7C,IAAI,MAAM,GAAG,OAAO,CAAC,kBAAkB,CAAC,CAAC;AACzC,IAAI,aAAa,GAAG,OAAO,CAAC,gBAAgB,CAAC,CAAC;AAC9C,IAAI,YAAY,GAAG,OAAO,CAAC,cAAc,CAAC,CAAC;AAC3C,IAAI,KAAK,GAAG,OAAO,CAAC,OAAO,CAAC,CAAC;AAC7B,IAAI,IAAI,GAAG,OAAO,CAAC,MAAM,CAAC,CAAC;AAC3B,IAAI,MAAM,GAAG,OAAO,CAAC,QAAQ,CAAC,CAAC;;AAE/B,IAAI,QAAQ,GAAG,OAAO,CAAC,YAAY,CAAC,CAAC;;IAE/B,kBAAkB;YAAlB,kBAAkB;;AACX,WADP,kBAAkB,CACV,IAAI,EAAE;;;0BADd,kBAAkB;;AAEpB,+BAFE,kBAAkB,6CAEd,IAAI,EAAE;;AAEZ,QAAI,YAAY,GAAG;AACjB,UAAI,EAAE,SAAS;AACf,kBAAY,EAAE,IAAI,CAAC,IAAI,CAAC,SAAS,EAAE,IAAI,EAAE,IAAI,EAAE,gDAAgD,CAAC;AAChG,oBAAc,EAAE,UAAU;KAE3B,CAAC;;;AAEF,QAAI,CAAC,IAAI,GAAG,eAAc,YAAY,EAAE,IAAI,CAAC,CAAC;AAC9C,QAAI,CAAC,UAAU,GAAG,IAAI,CAAC;;AAEvB,QAAI,CAAC,cAAc,GAAG,aAAY,UAAC,OAAO,EAAE,MAAM,EAAK;AACrD,YAAK,qBAAqB,GAAG,OAAO,CAAC;AACrC,YAAK,oBAAoB,GAAG,MAAM,CAAC;KACpC,CAAC,CAAC;;AAEH,QAAI,CAAC,WAAW,GAAG,aAAY,UAAC,OAAO,EAAE,MAAM,EAAK;AAClD,YAAK,kBAAkB,GAAG,OAAO,CAAC;AAClC,YAAK,iBAAiB,GAAG,MAAM,CAAC;KACjC,CAAC,CAAC;;AAEH,QAAI,CAAC,MAAM,GAAG,SAAQ,GAAG,CAAC,CACxB,IAAI,CAAC,cAAc,EACnB,IAAI,CAAC,WAAW,CACjB,CAAC,CAAC;;AAEH,QAAI,CAAC,cAAc,CAAC,IAAI,CAAC,UAAC,eAAe,EAAK;AAC5C,YAAK,IAAI,CAAC,eAAe,EAAE,eAAe,CAAC,CAAC;KAC7C,CAAC,CAAC;;AAEH,QAAI,CAAC,WAAW,CAAC,IAAI,CAAC,UAAC,QAAQ,EAAK;AAClC,YAAK,IAAI,CAAC,YAAY,EAAE,QAAQ,CAAC,CAAC;KACnC,CAAC,CAAC;;AAEH,QAAI,CAAC,MAAM,CAAC,IAAI,CAAC,UAAC,IAA2B,EAAK;iCAAhC,IAA2B;;UAA1B,eAAe;UAAE,QAAQ;;AAC1C,YAAK,IAAI,CAAC,OAAO,SAAQ,eAAe,EAAE,QAAQ,CAAC,CAAC;KACrD,CAAC,CAAC;GAEJ;;eAzCG,kBAAkB;;6BA2CA,aAAG;AACvB,aAAO,MAAM,KAAK,CAAC,OAAO,CAAC,OAAO,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;KACpD;;;6BAEe,aAAG;;;AAEjB,aAAO,CAAC,GAAG,CAAC,YAAY,CAAC,CAAC;;AAE1B,UAAI,IAAI,GAAG,IAAI,CAAC,IAAI,CAAC,YAAY,CAAC;AAClC,UAAI,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,EAAE;AACnB,YAAI,CAAC,IAAI,CAAC,IAAI,GAAG,MAAM,aAAa,CAAC,KAAK,CAAC,CAAC;OAC7C;;AAED,UAAI,CAAC,SAAS,GAAG,aAAa,CAAC,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,YAAY,EACzD,CAAC,SAAS,GAAG,IAAI,CAAC,IAAI,CAAC,IAAI,EAAE,SAAS,GAAG,IAAI,EAAE,eAAe,GAAG,IAAI,CAAE,EAAE;;;AAGvE,gBAAQ,EAAE,KAAK;OAChB,CAAC,CAAC;AACL,UAAI,CAAC,SAAS,CAAC,MAAM,CAAC,WAAW,CAAC,MAAM,CAAC,CAAC;AAC1C,UAAI,CAAC,SAAS,CAAC,MAAM,CAAC,WAAW,CAAC,MAAM,CAAC,CAAC;AAC1C,UAAI,CAAC,SAAS,CAAC,MAAM,CAAC,EAAE,CAAC,MAAM,EAAE,UAAC,IAAI,EAAK;AACzC,eAAK,IAAI,CAAC,QAAQ,EAAE,IAAI,CAAC,CAAC;;AAE1B,YAAI,IAAI,CAAC,KAAK,CAAC,wBAAwB,CAAC,EAAE;AACxC,iBAAK,qBAAqB,CAAC,OAAK,SAAS,CAAC,CAAC;AAC3C,iBAAK,cAAc,GAAG,IAAI,CAAC;AAC3B,iBAAK,IAAI,CAAC,eAAe,EAAE,OAAK,SAAS,CAAC,CAAC;SAC5C;;;OAGF,CAAC,CAAC;;AAEH,UAAI,CAAC,SAAS,CAAC,MAAM,CAAC,EAAE,CAAC,MAAM,EAAE,UAAC,IAAI,EAAK;AACzC,eAAK,IAAI,CAAC,QAAQ,EAAE,IAAI,CAAC,CAAC;;OAE3B,CAAC,CAAC;;;;AAIH,UAAI,CAAC,SAAS,CAAC,EAAE,CAAC,MAAM,EAAE,UAAC,IAAI,EAAK;AAClC,YAAI,CAAC,OAAK,cAAc,EAAE;AACxB,iBAAK,oBAAoB,CAAC,IAAI,CAAC,CAAC;SACjC;OACF,CAAC,CAAC;;AAEH,UAAI,CAAC,gBAAgB,EAAE,CAAC,IAAI,CAAC,UAAC,QAAQ,EAAK;AACzC,eAAK,QAAQ,GAAG,QAAQ,CAAC;AACzB,eAAO,CAAC,GAAG,CAAC,kBAAkB,EAAE,OAAK,QAAQ,CAAC,CAAC;AAC/C,eAAK,kBAAkB,CAAC,QAAQ,CAAC,CAAC;OACnC,EAAE,IAAI,CAAC,iBAAiB,CAAC,CAAC;;AAG3B,aAAO,IAAI,CAAC;KACb;;;6BAEgB,WAAC,IAAI,EAAE;AACtB,aAAO,QAAQ,CAAC,iBAAiB,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC;KAC/C;;;SArGG,kBAAkB;GAAS,MAAM,CAAC,YAAY;;AAyGpD,MAAM,CAAC,OAAO,GAAG;AACf,oBAAkB,EAAlB,kBAAkB;CACnB,CAAC","file":"application/packager.js","sourcesContent":["let child_process = require('child_process');\nlet crayon = require('@ccheever/crayon');\nlet freeportAsync = require('freeport-async');\nlet instapromise = require('instapromise');\nlet ngrok = require('ngrok');\nlet path = require('path');\nlet events = require('events');\n\nlet urlUtils = require('./urlUtils');\n\nclass PackagerController extends events.EventEmitter {\n  constructor(opts) {\n    super(opts);\n\n    let DEFAULT_OPTS = {\n      port: undefined,\n      packagerPath: path.join(__dirname, '..', '..', 'node_modules/react-native/packager/packager.sh'),\n      mainModulePath: 'index.js',\n      // absolutePath: root,\n    };\n\n    this.opts = Object.assign(DEFAULT_OPTS, opts);\n    this._givenOpts = opts;\n\n    this.packagerReady$ = new Promise((fulfill, reject) => {\n      this._packagerReadyFulfill = fulfill;\n      this._packagerReadyReject = reject;\n    });\n\n    this.ngrokReady$ = new Promise((fulfill, reject) => {\n      this._ngrokReadyFulfill = fulfill;\n      this._ngrokReadyReject = reject;\n    });\n\n    this.ready$ = Promise.all([\n      this.packagerReady$,\n      this.ngrokReady$,\n    ]);\n\n    this.packagerReady$.then((packagerProcess) => {\n      this.emit('packagerReady', packagerProcess);\n    });\n\n    this.ngrokReady$.then((ngrokUrl) => {\n      this.emit('ngrokReady', ngrokUrl);\n    });\n\n    this.ready$.then(([packagerProcess, ngrokUrl]) => {\n      this.emit('ready', this, packagerProcess, ngrokUrl);\n    });\n\n  }\n\n  async _startNgrokAsync() {\n    return await ngrok.promise.connect(this.opts.port);\n  }\n\n  async startAsync() {\n\n    console.log(\"startAsync\");\n\n    let root = this.opts.absolutePath;\n    if (!this.opts.port) {\n      this.opts.port = await freeportAsync(19000);\n    }\n\n    this._packager = child_process.spawn(this.opts.packagerPath,\n      [\"--port=\" + this.opts.port, \"--root=\" + root, \"--assetRoots=\" + root,], {\n        // stdio: [process.stdin, 'pipe', process.stderr],\n        // stdio: 'inherit',\n        detached: false,\n      });\n    this._packager.stdout.setEncoding('utf8');\n    this._packager.stderr.setEncoding('utf8');\n    this._packager.stdout.on('data', (data) => {\n      this.emit('stdout', data);\n\n      if (data.match(/React packager ready\\./)) {\n        this._packagerReadyFulfill(this._packager);\n        this._packagerReady = true;\n        this.emit('packagerReady', this._packager);\n      }\n\n      // crayon.yellow.log(\"STDOUT:\", data);\n    });\n\n    this._packager.stderr.on('data', (data) => {\n      this.emit('stderr', data);\n      // crayon.orange.error(\"STDERR:\", data);\n    });\n\n    // If the packager process exits before the packager is ready\n    // then the packager is never gonna be ready\n    this._packager.on('exit', (code) => {\n      if (!this._packagerReady) {\n        this._packagerReadyReject(code);\n      }\n    });\n\n    this._startNgrokAsync().then((ngrokUrl) => {\n      this.ngrokUrl = ngrokUrl;\n      console.log(\"Set ngrokUrl to \", this.ngrokUrl);\n      this._ngrokReadyFulfill(ngrokUrl);\n    }, this._ngrokReadyReject);\n\n\n    return this;\n  }\n\n  async getUrlAsync(opts) {\n    return urlUtils.constructUrlAsync(this, opts);\n  }\n\n}\n\nmodule.exports = {\n  PackagerController,\n};\n"],"sourceRoot":"/source/"}