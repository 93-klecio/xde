{"version":3,"sources":["application/packager.js"],"names":[],"mappings":"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","file":"application/packager.js","sourcesContent":["let child_process = require('child_process');\nlet crayon = require('@ccheever/crayon');\nlet freeportAsync = require('freeport-async');\nlet instapromise = require('instapromise');\nlet ngrok = require('ngrok');\nlet path = require('path');\nlet events = require('events');\n\nlet urlUtils = require('./urlUtils');\n\nclass PackagerController extends events.EventEmitter {\n  constructor(opts) {\n    super(opts);\n\n    let DEFAULT_OPTS = {\n      port: undefined,\n      packagerPath: path.join(__dirname, '..', '..', 'node_modules/react-native/packager/packager.sh'),\n      mainModulePath: 'index.js',\n      // absolutePath: root,\n    };\n\n    this.opts = Object.assign(DEFAULT_OPTS, opts);\n    this._givenOpts = opts;\n    this.packagerReady$ = new Promise((fulfill, reject) => {\n      this._packagerReadyFulfill = fulfill;\n      this._packagerReadyReject = reject;\n    });\n\n  }\n\n  async _startNgrokAsync() {\n    await ngrok.promise.connect(this.opts.port);\n  }\n\n  async startAsync() {\n\n    console.log(\"startAsync\");\n\n    let root = this.opts.absolutePath;\n    if (!this.opts.port) {\n      this.opts.port = await freeportAsync(19000);\n    }\n\n    this._packager = child_process.spawn(this.opts.packagerPath,\n      [\"--port=\" + this.opts.port, \"--root=\" + root, \"--assetRoots=\" + root,], {\n        // stdio: [process.stdin, 'pipe', process.stderr],\n        // stdio: 'inherit',\n        detached: false,\n      });\n    this._packager.stdout.setEncoding('utf8');\n    this._packager.stderr.setEncoding('utf8');\n    this._packager.stdout.on('data', (data) => {\n      this.emit('stdout', data);\n\n      if (data.match(/React packager ready\\./)) {\n        this._packagerReadyFulfill(this._packager);\n        this.emit('ready', this._packager);\n      }\n\n      // crayon.yellow.log(\"STDOUT:\", data);\n    });\n\n    this._packager.stderr.on('data', (data) => {\n      this.emit('stderr', data);\n      // crayon.orange.error(\"STDERR:\", data);\n    });\n\n    this._ngrok$ = this._startNgrokAsync();\n    this._ngrok$.then((ng) => {\n      this.emit('ngrokReady', ng);\n    });\n\n    return this;\n  }\n\n  async getUrlAsync(opts) {\n    return urlUtils.constructUrlAsync(this, opts);\n  }\n\n}\n\nmodule.exports = {\n  PackagerController,\n};\n"],"sourceRoot":"/source/"}